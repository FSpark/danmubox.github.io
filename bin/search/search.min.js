$(function(){"use strict";var r,n,t=$("#txt-keyword"),i=$("#table"),e=$("#ckb-copy"),c=new Map,s=["bilibili","优酷","爱奇艺","腾讯","第一弹","动画疯","acfun"];function a(t){n?l(t):$.get("data/list",function(o){n=Common.decrypt(o,r).split(","),l(t)})}function l(e){var t=n.length,a=0;n.forEach(function(n){if(c.has(n)){var o=c.get(n);u(e,n,o),d(++a,t)}else $.ajax({url:"https://raw.githubusercontent.com/"+n+"/master/index"}).done(function(o){var t=Common.decrypt(o,r).split(";").map(function(o,t){return o.split(",")});c.set(n,t),u(e,n,t)}).fail(function(o){toastr.error("请求弹幕仓库："+n+" 时，发生错误！"),console.error(o)}).always(function(){d(++a,t)})})}function d(o,t){o==t&&i.bootstrapTable("hideLoading")}function u(o,t,n){for(var e=[],a=n.length-1;0<=a;a--){var r=n[a];if(-1<r[0].toLowerCase().indexOf(o)){var c="https://raw.githubusercontent.com/"+t+"/master/"+r[3]+".7z";e.push({name:r[0],from:s[r[2]],length:r[1],operate:'<div class="btn-group"><button class="btn btn-success download">下载</button><button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"><span class="caret"></span></button><div class="dropdown-menu"><button class="dropdown-item btn download xl-download">迅雷下载</button></div></div>',url:c})}}0<e.length&&(i.bootstrapTable("append",e),i.bootstrapTable("hideLoading"))}Common.cookieIfPresent(ENUM_COOKIE_PATH.SEARCH,function(o){e.attr("checked",o.download_copy)}),e.change(function(){var o=$(this).is(":checked");Common.writeCookie(ENUM_COOKIE_PATH.SEARCH,{download_copy:o})}),$("#btn-search").click(function(){i.bootstrapTable("removeAll");var o=t.val();0<o.trim().length&&(i.bootstrapTable("showLoading"),function(t){r?a(t):$.get("data/key",function(o){r=CryptoJS.enc.Utf8.parse(o),a(t)})}(o.toLowerCase()))}),Common.fixTableHeight(i)}),window.operateEvents={"click .download":function(o,t,n,e){$("#ckb-copy").is(":checked")&&Common.clipboard(n.name,o);var a=$(o.target),r=n.url;a.hasClass("xl-download")&&(r="thunder://"+btoa("AA"+r+"ZZ")),Common.downloadFile(r)}};